{{<layout}}
{{$style}}
<link rel="stylesheet" href="{{request.contextPath}}/templates/default/admin/css/select2.min.css">
<style type="text/css">
.touch .select2-results li:hover {
	background-color: #5897FB !important;
}
.trumbowyg-box {
	width: 100%;
	margin: 0;
	border-radius: 2px;
}
.trumbowyg-button-pane {
	background: none;
}
.select2-container--default .select2-selection--single {
	border-radius: 2px;
	border: 1px solid #E8ECF3;
	line-height: 34px;
	height: 34px;
}
.select2-container--default .select2-selection--single .select2-selection__rendered {
	line-height: 34px;
}
.select2-dropdown, .select2-container--default .select2-search--dropdown .select2-search__field, .dropzone {
	border: 1px solid #E8ECF3;
	border-radius: 2px;
}
</style>
{{/style}}
{{$script}}
<script type="text/javascript" src="{{request.contextPath}}/templates/default/admin/js/select2.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	var $btn;
 	$(document).ajaxError(function() {
		toastr.error('出错了哟');
	})
	.on("click", "button.fa-remove", function() {
		var tbody = $(this).parents("tbody");
		var tr = $(this).parents("tr");
		var idField = tr.find(".article-id");
		if (idField.length) {
			$btn = $(this).button('loading');
			var url = "{{request.contextPath}}/admin/article/" + idField.val() + ".json?_method=DELETE";
			var confirmed = confirm("你确定要删除吗？");
			if (confirmed) {
				$.post(url, function(data) {
					$btn.button('reset');
					tr.remove();
					if (tbody.find("tr").length == 2) {
						$(".empty-row").show();
					}
				});
			} else {
				$btn.button('reset');
			}
		} else {
			$btn.button('reset');
			tr.remove();
			if (tbody.find("tr").length == 2) {
				$(".empty-row").show();
			}
		}
		
	});
 	
 	$("select").select2({
		ajax: {
			url: "{{request.contextPath}}/admin/category.json",
			cache: "true",
		    data: function (params) {
	        	return {
	          		page: params.page
	        	};
	      	},
			processResults: function(data) {
				var options = [{
					id: 0,
					text: "全部"
				}];
				$(data.content).each(function() {
					options.push({
						id: this.id,
						text: this.name
					});
				});
				return {
					results: options,
					pagination: {
						more: !data.last
					}
				}
			}
		},
		minimumResultsForSearch: Infinity
	});
 	
 	$(".fa-edit").click(function() {
 		var id = $(this).parents("tr").find("input:hidden").val();
 		location.href = "{{request.contextPath}}/admin/article/" + id + ".html";
 	});
});
</script>
{{/script}}
{{$title}}
文章管理 - 
{{/title}}
{{$nav}}
<ol class="breadcrumb no-margin">
	<li><a href="{{request.contextPath}}/admin/index.html">首页</a></li>
	{{#model.model}}
	<li><a href="{{request.contextPath}}/admin/article.html">文章</a></li>
	<li class="active">{{name}}</li>
	{{/model.model}}
	{{^model.model}}
	<li class="active">文章</li>
	{{/model.model}}
</ol>
{{/nav}}
{{$content}}
<div class="row mg-b">
	<div class="col-xs-6">
		<h3 class="no-margin">文章管理</h3>
	</div>
	<div class="col-xs-6 text-right">
		<a class="fa fa-plus btn btn-white" href="{{request.contextPath}}/admin/article/detail.html"> 添加文章</a>
	</div>
</div>
<div class="row">
	<div class="col-md-12">
		<section class="panel">
			<header class="panel-heading">列表</header>
			<div class="panel-heading">
				<form class="form-inline" role="form" method="get" action="{{request.contextPath}}/admin/article.html">
					<div class="form-group">
						<label for="title">标题: </label> 
						<input class="form-control" id="title" name="title" placeholder="标题: 输入*模糊匹配" type="text" value="{{#request.parameterMap.title}}{{.}}{{/request.parameterMap.title}}">
					</div>
					&nbsp;
					<div class="form-group">
						<label for="category_id">分类: </label>
						<select class="form-control" id="category_id" name="category_id" data-placeholder="分类" style="width:120px">
							{{#model.model}}
							<option value="{{id}}" selected>{{name}}</option>
							{{/model.model}}
						</select>
					</div>
					<button type="submit" class="btn btn-default">搜索</button>
				</form>
			</div>
			<div class="panel-body no-padding">
				<div class="table-responsive">
					<table 
						class="table table-hover table-striped responsive" >
						<thead>
							<tr>
								<th width="20%">标题</th>
								<th>封面</th>
								<th>分类</th>
								<th width="40%">概述</th>
								<th width="10%">操作</th>
							</tr>
						</thead>
						<tbody>
							{{#model}}
							<tr>
								<td class="article-name form-inline">{{title}}</td>
								<td class="article-cover">{{#cover}}<img src="{{cover}}" class="thumbnail" style="max-height: 120px;width: auto;">{{/cover}}</td>
								<td class="article-summary"><a href="{{request.contextPath}}/admin/article.html?category_id={{category.id}}">{{category.name}}</a></td>
								<td class="article-summary">{{summary}}</td>
								<td nowrap="nowrap">
									<input type="hidden" name="id" class="article-id" value="{{id}}">
									<span class="action-normal">
										<button class="fa fa-edit btn btn-white"> 编辑</button>
										<!--文章删除，由于有评论会发生错误，焦虑到评论的作用，暂不做处理-->
										<!--{{^published}}<button class="fa fa-remove btn btn-danger" data-loading-text="处理中..." autocomplete="off"> 删除</button>{{/published}}-->
									</span>
								</td>
							</tr>
							{{/model}}
							{{^model}}
							<tr class="empty-row">
								<td nowrap="nowrap">
								还没有文章呀，<a class="fa fa-plus btn btn-white" href="{{request.contextPath}}/admin/article/detail.html"> 添加</a> 一个
								</td>
								<td></td>
								<td></td>
							</tr>
							{{/model}}
						</tbody>
					</table>
				</div>
			</div>
		</section>
		{{>pagination}}
	</div>
</div>
{{/content}}
{{/layout}}